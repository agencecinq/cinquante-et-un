const c=o=>{var e=Object.prototype.toString.call(o);return typeof o=="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e)&&typeof o.length=="number"&&(o.length===0||typeof o[0]=="object"&&o[0].nodeType>0)};class a{constructor(){this.piecesCount=0,this.currentPieces={}}addPiece(e){typeof this.currentPieces[e.name]!="object"&&(this.currentPieces[e.name]={}),this.currentPieces[e.name][e.id]=e}removePiece(e){delete this.currentPieces[e.name][e.id]}}let l=new a;class h extends HTMLElement{constructor(e,{stylesheets:t=[]}={}){super(),this.name=e,this.template=document.createElement("template"),this.piecesManager=l,this.stylesheets=t,this.innerHTML!=""&&(this.baseHTML=this.innerHTML),this._boundListeners=new Map}connectedCallback(e=!0){e&&(typeof this.cid=="string"?this.cid=this.cid:this.cid=`c${this.piecesManager.piecesCount++}`,this.piecesManager.addPiece({name:this.name,id:this.cid,piece:this})),this.privatePremount(e),this.baseHTML==null&&(this.innerHTML="",this.template.innerHTML=this.render()!=null?this.render():"",this.appendChild(this.template.cloneNode(!0).content)),this.privateMount(e)}render(){if(this.baseHTML!=null)return this.baseHTML}disconnectedCallback(){this.privateUnmount()}adoptedCallback(){}privatePremount(e=!0){this.baseHTML==null&&(this.innerHTML=""),this.log&&console.log("🚧 premount",this.name),this.loadStyles(e),this.premount(e)}premount(e=!0){}privateMount(e){this.log&&console.log("✅ mount",this.name),this.mount(e)}mount(e=!0){}privateUpdate(){this.log&&console.log("🔃 update",this.name),this.update(),this.privateUnmount(!0),this.connectedCallback(!1)}update(){}privateUnmount(e=!1){e||this.piecesManager.removePiece({name:this.name,id:this.cid}),this.log&&console.log("❌ unmount",this.name),this.unmount(e)}unmount(e=!1){}attributeChangedCallback(e,t,n){t!==n&&(this[e]=n,this.privateUpdate())}$(e,t=this){return t.querySelectorAll(e)}dom(e,t=this){return t.querySelectorAll(e)}domAttr(e,t=this){return t.querySelectorAll(`[data-dom="${e}"]`)}captureTree(e=this){const t=this.querySelectorAll("[data-dom]");let n={};for(let s of t){const i=s.getAttribute("data-dom");typeof n[i]>"u"&&(n[i]=[]),n[i].push(s)}return n}on(e,t,n,s=null){if(t!=null){const i=`${e}_${n.name}`;if(!this._boundListeners.has(i)){const u=n.bind(this);this._boundListeners.set(i,{original:n,bound:u})}const r=this._boundListeners.get(i).bound;c(t)?t.length>0&&t.forEach(u=>{s==null?u.addEventListener(e,r):u.addEventListener(e,()=>r(s))}):s==null?t.addEventListener(e,r):t.addEventListener(e,()=>r(s))}}off(e,t,n){if(t!=null){const s=`${e}_${n.name}`,i=this._boundListeners.get(s);if(!i){console.warn(`No bound listener found for ${s}`);return}const r=i.bound;c(t)?t.length>0&&t.forEach(u=>{u.removeEventListener(e,r)}):t.removeEventListener(e,r),this._boundListeners.delete(s)}}emit(e,t=document,n){const s=new CustomEvent(e,{detail:n});t.dispatchEvent(s)}call(e,t,n,s){Object.keys(this.piecesManager.currentPieces).forEach(i=>{i==n&&Object.keys(this.piecesManager.currentPieces[i]).forEach(r=>{s!=null?r==s&&this.piecesManager.currentPieces[i][r].piece[e](t):this.piecesManager.currentPieces[i][r].piece[e](t)})})}async loadStyles(e=!0){if(e)for(let t=0;t<this.stylesheets.length;t++)await this.stylesheets[t]()}get log(){return typeof this.getAttribute("log")=="string"}get cid(){return this.getAttribute("cid")}set cid(e){return this.setAttribute("cid",e)}get properties(){return Object.values(this.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}}class d extends h{constructor(){super("Counter")}mount(){console.log("mount Counter"),this.$button=this.$("button")[0],this.on("click",this.$button,this.click)}unmount(){console.log("unmount Counter"),this.off("click",this.$button[0],this.click)}render(){return`
		  <h2>${this.name} component</h2>
		  <p>Value: ${this.value}</p>
		  <button class="c-button">Increment</button>
		`}click(){this.value=parseInt(this.value)+1}set value(e){return this.setAttribute("value",e)}get value(){return this.getAttribute("value")}static get observedAttributes(){return["value"]}}customElements.define("c-counter",d);
