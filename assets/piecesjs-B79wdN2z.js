const u=async(a,e,t=document)=>{t.getElementsByTagName(a).length>0&&await e()},c=a=>{var e=Object.prototype.toString.call(a);return typeof a=="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e)&&typeof a.length=="number"&&(a.length===0||typeof a[0]=="object"&&a[0].nodeType>0)};class l{constructor(){this.piecesCount=0,this.currentPieces={}}addPiece(e){typeof this.currentPieces[e.name]!="object"&&(this.currentPieces[e.name]={}),this.currentPieces[e.name][e.id]=e}removePiece(e){delete this.currentPieces[e.name][e.id]}}let h=new l;class d extends HTMLElement{constructor(e,{stylesheets:t=[]}={}){super(),this.name=e,this.template=document.createElement("template"),this.piecesManager=h,this.stylesheets=t,this.innerHTML!=""&&(this.baseHTML=this.innerHTML),this._boundListeners=new Map}connectedCallback(e=!0){e&&(typeof this.cid=="string"?this.cid=this.cid:this.cid=`c${this.piecesManager.piecesCount++}`,this.piecesManager.addPiece({name:this.name,id:this.cid,piece:this})),this.privatePremount(e),this.baseHTML==null&&(this.innerHTML="",this.template.innerHTML=this.render()!=null?this.render():"",this.appendChild(this.template.cloneNode(!0).content)),this.privateMount(e)}render(){if(this.baseHTML!=null)return this.baseHTML}disconnectedCallback(){this.privateUnmount()}adoptedCallback(){}privatePremount(e=!0){this.baseHTML==null&&(this.innerHTML=""),this.log&&console.log("🚧 premount",this.name),this.loadStyles(e),this.premount(e)}premount(e=!0){}privateMount(e){this.log&&console.log("✅ mount",this.name),this.mount(e)}mount(e=!0){}privateUpdate(){this.log&&console.log("🔃 update",this.name),this.update(),this.privateUnmount(!0),this.connectedCallback(!1)}update(){}privateUnmount(e=!1){e||this.piecesManager.removePiece({name:this.name,id:this.cid}),this.log&&console.log("❌ unmount",this.name),this.unmount(e)}unmount(e=!1){}attributeChangedCallback(e,t,s){t!==s&&(this[e]=s,this.privateUpdate())}$(e,t=this){return t.querySelectorAll(e)}dom(e,t=this){return t.querySelectorAll(e)}domAttr(e,t=this){return t.querySelectorAll(`[data-dom="${e}"]`)}captureTree(e=this){const t=this.querySelectorAll("[data-dom]");let s={};for(let n of t){const i=n.getAttribute("data-dom");typeof s[i]>"u"&&(s[i]=[]),s[i].push(n)}return s}on(e,t,s,n=null){if(t!=null){const i=`${e}_${s.name}`;if(!this._boundListeners.has(i)){const o=s.bind(this);this._boundListeners.set(i,{original:s,bound:o})}const r=this._boundListeners.get(i).bound;c(t)?t.length>0&&t.forEach(o=>{n==null?o.addEventListener(e,r):o.addEventListener(e,()=>r(n))}):n==null?t.addEventListener(e,r):t.addEventListener(e,()=>r(n))}}off(e,t,s){if(t!=null){const n=`${e}_${s.name}`,i=this._boundListeners.get(n);if(!i){console.warn(`No bound listener found for ${n}`);return}const r=i.bound;c(t)?t.length>0&&t.forEach(o=>{o.removeEventListener(e,r)}):t.removeEventListener(e,r),this._boundListeners.delete(n)}}emit(e,t=document,s){const n=new CustomEvent(e,{detail:s});t.dispatchEvent(n)}call(e,t,s,n){Object.keys(this.piecesManager.currentPieces).forEach(i=>{i==s&&Object.keys(this.piecesManager.currentPieces[i]).forEach(r=>{n!=null?r==n&&this.piecesManager.currentPieces[i][r].piece[e](t):this.piecesManager.currentPieces[i][r].piece[e](t)})})}async loadStyles(e=!0){if(e)for(let t=0;t<this.stylesheets.length;t++)await this.stylesheets[t]()}get log(){return typeof this.getAttribute("log")=="string"}get cid(){return this.getAttribute("cid")}set cid(e){return this.setAttribute("cid",e)}get properties(){return Object.values(this.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}}export{d,u as l};
